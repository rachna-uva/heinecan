<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Health and Safety Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- FontAwesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Custom CSS -->
  <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="d-flex" id="wrapper">
  <!-- Sidebar -->
  <div class="bg-dark-grey text-white position-relative" id="sidebar">
    <h2 class="text-center p-3">Health and Safety Dashboard</h2>
    <ul class="list-unstyled px-3">
      <li>
        <a href="#" class="text-white" data-page="dashboard" data-i18n="dashboard">
          <i class="fas fa-thermometer-half"></i> Dashboard
        </a>
      </li>
      <li>
        <a href="#" class="text-white d-flex align-items-center justify-content-between" data-page="notifications" data-i18n="notifications">
          <span><i class="fas fa-cloud-sun"></i> Notifications</span>
          <span id="notif-badge" class="badge bg-danger ms-2" style="display: none;">●</span>
        </a>
      </li>
        <li class="text-center my-3 list-unstyled">
      <div id="shift-toggle" class="btn-group rounded-pill" role="group">
        <button type="button" class="btn btn-sm" id="dayShiftBtn" data-i18n="dayShift">Day Shift</button>
        <button type="button" class="btn btn-sm" id="nightShiftBtn" data-i18n="nightShift">Night Shift</button>
      </div>
      </li>
      <li class="text-center my-3 list-unstyled">
        <select id="citySelector" class="form-select form-select-sm w-auto mx-auto">
          <option value="monterrey">Monterrey, Mexico</option>
          <option value="amsterdam">Amsterdam, Netherlands</option>
          <option value="singapore">Singapore</option>
        </select>
      </li>
    </ul>

  <div id="language-switcher" class="position-fixed top-0 end-0 p-3">
  <div class="language-tabs">
    <span data-lang="en" class="lang-tab active">English</span>
    <span data-lang="es" class="lang-tab">Español</span>
  </div>
</div>

  </div>

  <!-- Page Content -->
  <div id="page-content-wrapper" class="p-4">
    <div id="dynamic-content">Loading...</div>
  </div>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script src="script.js"></script>

<script>
  function loadPage(page) {
    fetch(`${page}.html`)
      .then(res => res.text())
      .then(html => {
        document.getElementById("dynamic-content").innerHTML = html;

        // Load specific JS logic for the loaded partial
        if (page === "dashboard" && typeof loadCSV === 'function'){ loadCSV();attachToggleChartListener();};
        if (page === "notifications" && typeof initNotifications === 'function') initNotifications();
        if (page === "rewards" && typeof initRewards === 'function') initRewards();
      });
  }

  document.querySelectorAll('#sidebar a[data-page]').forEach(link => {
    link.addEventListener('click', (e) => {
      e.preventDefault();
      const page = link.getAttribute('data-page');
      loadPage(page);
    });
  });

  window.addEventListener('DOMContentLoaded', () => {
    const badge = document.getElementById('notif-badge');
    const saved = JSON.parse(localStorage.getItem('notifications')) || [];
    if (saved.length > 0 && badge) {
      badge.style.display = 'inline-block';
    }

    // Load default view
    loadPage("dashboard");
  });
</script>

</body>
</html>
